---
title: "ruby/gem_rbs_collection に初めてコントリビュートした話"
categories:
    - blog
tags:
    - Ruby
    - RBS
    - OSS
toc: true
---

SUZURIに[rbs-inline](https://github.com/soutaro/rbs-inline)と[steep](https://github.com/soutaro/steep)による型付け・型検査を導入する中で、gemの型エラーがいくつか検出されました。
調べてみると [ruby/gem_rbs_collection](https://github.com/ruby/gem_rbs_collection) 側で未対応のものが見つかったので、初めてコントリビュートしてみました。

## gem_rbs_collection とは

[gem_rbs_collection](https://github.com/ruby/gem_rbs_collection) は、RBSを同梱していないgemのための型定義を集めた、コミュニティ管理のリポジトリです。

```bash
rbs collection init
rbs collection install
```

で簡単に導入でき、steepなどの型チェッカーと組み合わせて利用できます。

## 出したPR

3つのPRを出し、全てマージされました。

### PR #871: GraphQL::ExecutionError#initialize の型定義追加

[graphql: Add types for GraphQL::ExecutionError#initialize #871](https://github.com/ruby/gem_rbs_collection/pull/871)

graphql gemの `GraphQL::ExecutionError#initialize` メソッドに型定義がなかったため、追加しました。

**型定義の追加:**

```rbs
def initialize: (String message, ?ast_node: untyped, ?extensions: Hash[untyped, untyped]?) -> void
```

**テストの追加:**

```ruby
def error_field
  raise GraphQL::ExecutionError.new("Test error message", ast_node: nil, extensions: { "code" => "TEST_ERROR" })
end
```

これが初PRでした。gem_rbs_collectionは[レビュー無しでもマージできる運用](https://www.timedia.co.jp/tech/20240513-tech/)になっていますが、初めてで心配だったので念のためレビューを依頼しました。当初は `options` パラメータも含めて提案していましたが、レビューでdeprecatedであることを指摘されたため除外し、approveをもらってからマージしました。

### PR #887: RQRCode::QRCode#initialize の型定義修正

[rqrcode: Fix type definition for RQRCode::QRCode#initialize #887](https://github.com/ruby/gem_rbs_collection/pull/887)

rqrcode gemの `RQRCode::QRCode#initialize` の型定義が実装と合っていなかったため、修正しました。

**Before:**

```rbs
def initialize: (String) -> void
```

**After:**

```rbs
def initialize: (String, *untyped) -> void
```

実際には `level` などのオプション引数を受け取れるため、`*untyped` を追加しました。

**テストの修正:**

```ruby
# Before
qr = RQRCode::QRCode.new("https://kyan.com")

# After
qr = RQRCode::QRCode.new("https://kyan.com", level: :h)
```

### PR #933: GraphQL::Schema::Resolver.null メソッド署名の追加

[graphql: Add GraphQL::Schema::Resolver.null method signature #933](https://github.com/ruby/gem_rbs_collection/pull/933)

graphql gemの `GraphQL::Schema::Resolver.null` クラスメソッドの型定義を追加しました。

**型定義の追加:**

```rbs
def self.null: (?bool allow_null) -> untyped
```

**テストの追加:**

```ruby
class Ping < BaseMutation
  null true
  # ...
end
```

## おわりに

RBSの型定義は社内でパッチを用意して暫定対応することもできますが、以前 RubyKaigi 2022 の発表 [Types teaches success, what will we do?](https://rubykaigi.org/2022/presentations/fugakkbn.html) を聞いていたので、この機会にコントリビュートしてみることにしました。

実際にやってみると、ハードルは思ったより低かったです。型定義の不足や誤りを見つけたら、暫定対応だけでなくコントリビュートも選択肢に入れてみてはいかがでしょうか。
